<!doctype html><html xmlns="http://www.w3.org/1999/xhtml"><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns#"><title>Buck: android_build_config()</title><link type="image/png" rel="shortcut icon" href="/buck/static/favicon.png" /><meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no" /><meta http-equiv="content-type" content="text/html;charset=utf-8"><link type="text/css" rel="stylesheet" href="/buck/google-code-prettify/prettify.css" ><link type="text/css" rel="stylesheet" href="/buck/static/buck.css"><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-40185670-1', 'github.io'); ga('send', 'pageview');</script><meta property="og:locale" content="en_US"><meta property="og:title" content="android_build_config()"><meta property="og:site_name" content="Buck: an Android build tool"><meta property="og:image" content="http://facebook.github.io/buck/static/og.png"><meta property="og:type" content="article"><meta property="og:description" content="A rule that is used to generate a BuildConfig class with global configuration variables that android_library() rules can compile against."><meta property="fb:admins" content="584556688222168"></head><body><div id="fb-root"></div><script>(function(d, s, id) {var js, fjs = d.getElementsByTagName(s)[0]; if (d.getElementById(id)) return; js = d.createElement(s); js.id = id; js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=584556688222168"; fjs.parentNode.insertBefore(js, fjs);}(document, 'script', 'facebook-jssdk'));</script><header class='topbar'><nav class='width'><a href='http://facebook.github.io/buck/'><h1>Buck</h1></a><ul class='menu'><li><a href='/buck/setup/quick_start.html'>Get Started</a><li><a href='https://groups.google.com/forum/#!forum/buck-build'>Group</a><li><a href='/buck/javadoc/'>API</a><li><a href='https://github.com/facebook/buck'>GitHub</a></ul></nav></header><section class='content'><div class='width'><article><h1>android_build_config()</h1><div class="overview"><p><small>This is liable to change in the future.</small></p>An <code>android_build_config()</code> rule is used to generate a <code>BuildConfig</code> class with global configuration variables that other <a href="/buck/rule/android_library.html"><code>android_library</code></a> rules can compile against. Currently, the only variable exposed by <code>BuildConfig</code> is a global <code>boolean</code> named <code>DEBUG</code>, much like the <code>BuildConfig.java</code> generated by the official Android build tools based on Gradle.<p><p>The fields in the generated <code>BuildConfig</code> class will be non-constant-expressions (see <a href="http://docs.oracle.com/javase/specs/jls/se7/html/jls-15.html#jls-15.28">JLS 15.28</a>). However, if <code>BuildConfig</code> is packaged into an APK, it will be replaced with a new version where:<ul><li>The fields will be set to literal values (i.e., constant expressions).<li>The <code>boolean BuildConfig.DEBUG</code> field will correspond to that of the <code>package_type</code> argument to the <a href="/buck/rule/android_binary.html"><code>android_binary</code></a> rule that is packaging it.</ul>This transformation is done before ProGuard is applied (if applicable), so that it can propagate constants from <code>BuildConfig</code> and eliminate dead code.<h2>Arguments</h2><ul class="arglist"><li class="arg"><code>name</code> (required) The name of the rule.<li class="arg"><code>package</code> (required) Name of the Java package to use in the generated <code>BuildConfig.java</code> file. Most developers set this to the application id declared in the manifest via <code>&lt;manifest package="APP_ID"&gt;</code>. Example: <code>com.facebook.orca</code>.<li class="arg"><code>values</code> (defaults to <code>[]</code>) <p>List of strings that defines additional fields (and values) that should be declared in the generated <code>BuildConfig.java</code> file. Like <code>DEBUG</code>, the values will be non-constant-expressions that evaluate to the value specified in the file at compilation time. To override the values in an APK, specify <tt>build_config_values</tt> or <tt>build_config_values_file</tt> in <a href="/buck/rule/android_binary.html"><code>android_binary</code></a>.<li class="arg"><code>values_file</code> (defaults to <code>None</code>) <p>Optional path to a file that defines additional fields (and values) that should be declared in the generated <code>BuildConfig.java</code> file. Like <code>DEBUG</code>, the values will be non-constant-expressions that evaluate to the value specified in the file at compilation time. To override the values in an APK, specify <tt>build_config_values</tt> or <tt>build_config_values_file</tt> in <a href="/buck/rule/android_binary.html"><code>android_binary</code></a>.<p>Note that <tt>values_file</tt> can be a generated file, as can <tt>build_config_values_file</tt> as demonstrated in the example below.<li class="arg"><code>visibility</code> (defaults to <code>[]</code>) List of <a href="/buck/concept/build_target_pattern.html">build target patterns</a> that identify the build rules that can include this rule in its <code>deps</code>.</ul><h2>Examples</h2><p><p>Here is an example of an <code>android_build_config()</code> rule that is transitively included by both <em>debug</em> and <em>release</em> versions of an <a href="/buck/rule/android_binary.html"><code>android_binary</code></a> rule. The value of <code>com.example.pkg.BuildConfig.DEBUG</code> will be different in each APK even though they both transitively depend on the same <code>:build_config</code> rule.<pre class="prettyprint lang-py">
android_build_config(
  name = 'build_config',
  package = 'com.example.pkg',
  values = [
    'String COMMIT_ID = "0000000000000000000000000000000000000000"',
  ],
)

# The .java files in this library may contain references to the boolean
# com.example.pkg.BuildConfig.DEBUG because :build_config is in the deps.
# It could also reference BuildConfig.COMMIT_ID.
android_library(
  name = 'mylib',
  srcs = glob(['src/**&#47;*.java']),
  deps = [
    ':build_config',
  ],
)

android_binary(
  name = 'debug',
  package_type = 'DEBUG',
  keystore =  '//keystores:debug',
  manifest = 'AndroidManifest.xml',
  target = 'Google Inc.:Google APIs:19',
  deps = [
    ':mylib',
  ],
)

# The contents of the file generated by this rule might be:
#
# String COMMIT_ID = "7bf804bdf71fdbfc99cce3b155b3643f022c6fa4"
#
# Note that the output of :build_config_release_values will be cached by Buck.
# Assuming that generate_release_build_config.py depends on state that is not
# expressed by its deps (which violates a fundamental invariant in Buck!), a
# workaround is to ensure that the inputs to :build_config_release_values are
# changed in some way before :release is built to ensure that the output from
# :build_config_release_values is not pulled from cache. For example:
#
# $ buck build :release
# $ uuidgen > dummy_state_file.txt
# $ buck build :release
#
# This makes sure that generate_release_build_config.py is re-run before
# :release is rebuilt. This is much cheaper than deleting your build cache
# before rebuilding.
genrule(
  name = 'build_config_release_values',
  srcs = [ 'generate_release_build_config.py', 'dummy_state_file.txt' ],
  bash = 'generate_release_build_config.py $OUT',
  out = 'build_config_release_values.txt',
)

android_binary(
  name = 'release',
  package_type = 'RELEASE',
  keystore =  '//keystores:release',
  manifest = 'AndroidManifest.xml',
  target = 'Google Inc.:Google APIs:19',
  build_config_values_file = ':build_config_release_values',
  deps = [
    ':mylib',
  ],
)
</pre></div></article><nav><h3>Getting Started</h3><ul><li><a href="/buck/">Overview</a><li><a href="/buck/setup/quick_start.html">Quick Start</a><li><a href="/buck/setup/install.html">Downloading and Installing Buck</a><li><a href="/buck/article/exopackage.html">Exopackage</a></ul><h3>About</h3><ul><li><a href="/buck/concept/what_makes_buck_so_fast.html">What Makes Buck so Fast?</a><li><a href="/buck/concept/troubleshooting.html">Troubleshooting</a><li><a href="/buck/about/performance_tuning.html">Performance Tuning</a><li><a href="/buck/concept/faq.html">FAQ</a></ul><h3>Concepts</h3><ul><li><a href="/buck/concept/build_rule.html">Build Rule</a><li><a href="/buck/concept/build_target.html">Build Target</a><li><a href="/buck/concept/build_file.html">Build File</a><li><a href="/buck/concept/buckversion.html">.buckversion</a><li><a href="/buck/concept/nobuckcheck.html">.nobuckcheck</a><li><a href="/buck/concept/buckconfig.html">.buckconfig</a><li><a href="/buck/concept/build_target_pattern.html">Build Target Pattern</a><li><a href="/buck/concept/visibility.html">Visibility</a><li><a href="/buck/concept/http_cache_api.html">HTTP Cache API</a></ul><h3>Build Rules</h3><ul><li><a href="/buck/rule/android_binary.html">android_binary()</a><li><a href="/buck/rule/android_build_config.html">android_build_config()</a><li><a href="/buck/rule/android_library.html">android_library()</a><li><a href="/buck/rule/android_prebuilt_aar.html">android_prebuilt_aar()</a><li><a href="/buck/rule/android_resource.html">android_resource()</a><li><a href="/buck/rule/apk_genrule.html">apk_genrule()</a><li><a href="/buck/rule/gen_aidl.html">gen_aidl()</a><li><a href="/buck/rule/genrule.html">genrule()</a><li><a href="/buck/rule/java_binary.html">java_binary()</a><li><a href="/buck/rule/java_library.html">java_library()</a><li><a href="/buck/rule/java_test.html">java_test()</a><li><a href="/buck/rule/keystore.html">keystore()</a><li><a href="/buck/rule/ndk_library.html">ndk_library()</a><li><a href="/buck/rule/prebuilt_jar.html">prebuilt_jar()</a><li><a href="/buck/rule/prebuilt_native_library.html">prebuilt_native_library()</a><li><a href="/buck/rule/project_config.html">project_config()</a><li><a href="/buck/rule/python_binary.html">python_binary()</a><li><a href="/buck/rule/python_library.html">python_library()</a><li><a href="/buck/rule/python_test.html">python_test()</a></ul><h3>Functions</h3><ul><li><a href="/buck/function/glob.html">glob()</a><li><a href="/buck/function/include_defs.html">include_defs()</a><li><a href="/buck/function/string_parameter_macros.html">String Parameter Macros</a></ul><h3>Commands</h3><ul><li><a href="/buck/command/audit.html">buck audit</a><li><a href="/buck/command/build.html">buck build</a><li><a href="/buck/command/clean.html">buck clean</a><li><a href="/buck/command/install.html">buck install</a><li><a href="/buck/command/project.html">buck project</a><li><a href="/buck/command/quickstart.html">buck quickstart</a><li><a href="/buck/command/targets.html">buck targets</a><li><a href="/buck/command/test.html">buck test</a><li><a href="/buck/command/uninstall.html">buck uninstall</a><li><a href="/buck/command/buckd.html">buckd</a></ul><h3>Extending Buck</h3><ul><li><a href="/buck/extending/macros.html">Custom Macros</a><li><a href="/buck/extending/rules.html">Custom Rules</a></ul><h3>Contributing to Buck</h3><ul><li><a href="https://groups.google.com/group/buck-build">Discussion Group</a><li><a href="https://github.com/facebook/buck/issues/new">Report a Bug</a><li><a href="/buck/contributing/tour.html">Tour of the Codebase</a><li><a href="/buck/contributing/development.html">Development Workflow</a><li><a href="/buck/contributing/codestyle.html">Code Style</a><li><a href="/buck/contributing/logging.html">Logging</a><li><a href="/buck/contributing/immutables.html">Immutable Value Types</a><li><a href="/buck/javadoc">API</a><li><a href="https://github.com/facebook/buck">Browse the Source Code</a></ul></ul></nav></div></section><footer><div class='width'>&copy; Copyright Facebook, 2013 -</div></footer><script src="/buck/google-code-prettify/prettify.js"></script><script>prettyPrint()</script></body></html>